{% extends 'base.html' %}
{% block content %}

<h4>Edit Booking</h4>
<form method="post">
    <label for="name">Guest Name</label>
    <input name="name" placeholder="Guest Name" required value="{{ booking.name }}">

    <label for="Checkin">CheckIn Date</label>
    <input type="date" name="datein" id="datein" required value="{{ booking.checkin }}">

    <label for="Checkout">Checkout Date</label>
    <input type="date" name="dateout" id="dateout" required value="{{ booking.checkout }}">

    <label for="stay">Nights</label>
    <input type="number" name="stay" id="stay" required readonly value="{{ booking.Nights }}">

    <label for="category">Type of Booking</label>
    <select name="category" id="category">
        <option value="villa" {% if booking.Category == 'villa' %}selected{% endif %}>Villa</option>
        <option value="room" {% if booking.Category == 'room' %}selected{% endif %}>Room</option>
        <option value="complete" {% if booking.Category == 'complete' %}selected{% endif %}>Full Property</option>
    </select>

    <div id="rooms-wrapper" style="display:none;">
        <label for="rooms">Number of Rooms</label>
        <input type="number" name="rooms" id="rooms" min="1" value="{{ booking.rooms or 1 }}">
    </div>

    <label for="food">Food Included</label>
    <select name="food" id="food">
        <option value="Yes" {% if booking.food == 'Yes' %}selected{% endif %}>YES</option>
        <option value="No" {% if booking.food == 'No' %}selected{% endif %}>NO</option>
    </select>
    
    <label for="price-stay">Total Amount(Stay) ₹</label>
    <input type="number" name="price-stay" id="price-stay" value="{{ booking.Amountstay }}">

    <label for="price-food" >Total Amount(Food) ₹</label>
    <input type="number" name="price-food" id="price-food" value="{{ booking.Amountfood }}">

    <label for="TotalBill">Total Amount ₹</label>
    <input type="text" id="total-bill" name="total-bill" readonly value="{{ booking.TotalBill }}">

    <button type="submit">Update Booking</button>
</form>

<script>
window.onload = function () {
    const stayInput = document.getElementById('price-stay');
    const foodInput = document.getElementById('price-food');
    const totalBillInput = document.getElementById('total-bill');
    const dateInInput = document.getElementById('datein');
    const dateOutInput = document.getElementById('dateout');
    const nightsInput = document.getElementById('stay');
    const categorySelect = document.getElementById('category');
    const roomsWrapper = document.getElementById('rooms-wrapper');
    const roomsInput = document.getElementById('rooms');

    function updateTotal() {
        const stay = parseFloat(stayInput.value) || 0;
        const food = parseFloat(foodInput.value) || 0;
        const total = stay + food;
        totalBillInput.value = total.toFixed(2);
    }

    function calculateNights() {
        const checkin = new Date(dateInInput.value);
        const checkout = new Date(dateOutInput.value);
        if (!isNaN(checkin) && !isNaN(checkout)) {
            const diffTime = checkout - checkin;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            nightsInput.value = diffDays > 0 ? diffDays : 0;
        }
    }

    function toggleRooms() {
        if (categorySelect.value === 'room') {
            roomsWrapper.style.display = '';
            roomsInput.disabled = false;
        } else {
            roomsWrapper.style.display = 'none';
            roomsInput.disabled = true;
        }
    }

    stayInput.addEventListener('input', updateTotal);
    foodInput.addEventListener('input', updateTotal);
    dateInInput.addEventListener('change', calculateNights);
    dateOutInput.addEventListener('change', calculateNights);
    categorySelect.addEventListener('change', toggleRooms);

    // initialize on load
    toggleRooms();
}
</script>

{% endblock %}


